---
title: "Reproducible Research: Peer Assessment 2"
author: Jose Antonio R Neto (joseantonio@me.com)
output: 
  html_document:
    keep_md: true
---
# INTRODUCTION
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

# QUESTIONS
Your data analysis must address the following questions:

1 - Across the United States, which types of events (as indicated in the ???????????????????????? variable) are most harmful with respect to population health?

2 - Across the United States, which types of events have the greatest economic consequences?

Consider writing your report as if it were to be read by a government or municipal manager who might be responsible for preparing for severe weather events and will need to prioritize resources for different types of events. However, there is no need to make any specific recommendations in your report.


## 1 - Loading and preprocessing the data

* Defining libraries

```{r}
getwd()
library(knitr)
library(markdown)
library(rmarkdown)
library(plyr)
library(dplyr)
library(Hmisc)
```

* Loading the data NOAA storm data into R

```{r}
storm <- read.csv(file = "repdata-data-StormData.csv", header = TRUE, sep = ",")

```

```{r, echo=TRUE}
names(activity)
```

```{r, echo= TRUE}
str(activity)
```


## 2 - What is mean total number of steps taken per day?

* Calculate the sum of steps taken by day

```{r, echo= TRUE}
sumSteps <- aggregate(steps ~ date, data = activity,  FUN="sum")
sumSteps
```

* Histogram of the total number of steps taken each day.

```{r, echo = TRUE}
hist(sumSteps$steps, col = 'blue',  xlab = 'Total Steps per Day', main = "Histogram of Activities")
## saving the plot
dev.copy(png,'hist-total-steps.png',  width = 480, height = 480)
dev.off()
```

* Calculate the mean and median of the total number of steps taken per day 

* Total Mean Steps taken per day
```{r, echo = TRUE}
meanStepsPerDay <- aggregate(steps ~ date, data = activity, FUN = "mean")
meanStepsPerDay
totalMeanSteps <- mean(sumSteps$steps)
totalMeanSteps
```

* Total Median Steps 
```{r, echo = TRUE}
totalMedianSteps <- median(sumSteps$steps)
totalMedianSteps
```


## 3 - What is the average daily activity pattern?

* Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r, echo=TRUE}
averageSteps <- aggregate(steps~interval, data=activity, FUN="mean")
averageSteps
```

* Time series plot of the average number of steps taken

```{r, echo=TRUE}
plot(x = averageSteps$interval, y = averageSteps$steps, type = "l", lwd=2, xlab = "Intervals",
     ylab = "Average number of steps", main = "Average Daily activity Pattern")
## saving the plot
dev.copy(png,'average-number-steps.png',  width = 480, height = 480)
dev.off()
```


* Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of step

```{r, echo=TRUE}
averageSteps[which.max(averageSteps$steps),]
averageSteps[which.max(averageSteps$steps),]$interval

```


## 4 - Strategy of Imputing Missing Values

* Total number of missing values (total rows with NAs) 

```{r, echo=TRUE}
missingValues <- is.na(activity$steps)
table(missingValues)
```

* Creating a New Dataset (wrangling it). Filling the missing data with average.

```{r, echo=TRUE}
newDataset <- activity
newDataset$steps <- with(newDataset,impute(steps,mean))
newDataset$date <- as.Date(newDataset$date)
str(newDataset)
sumNewdataset <- aggregate(steps ~ date, data = newDataset, FUN = "sum", na.rm = TRUE)
sumNewdataset
```

* Histogram of the total number of steps taken each day after missing values are imputed.

```{r, echo=TRUE}
hist(sumNewdataset$steps, main="Steps Per Day By Frequency",xlab="Daily Steps")
## saving the plot
dev.copy(png,'steps-each-day.png',  width = 480, height = 480)
dev.off()
```

* Mean and Median of newDataset

```{r, echo=TRUE}
mean(sumNewdataset$steps, na.rm = TRUE)
median(sumNewdataset$steps, na.rm = TRUE)
```


## 5 - Are there differences in activity patterns between weekdays and weekends?
* Use function Weekdays()

```{r, echo=TRUE}
dataWeek <- transform(newDataset, day = weekdays(date))
```


* Create a new factor variable in the dataset with two levels ??? ???weekday??? and ???weekend??? indicating whether a given date is a weekday or weekend day.

```{r, echo=TRUE}
weekdays <- c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
weekdays
dataWeek$weekClass <- factor(dataWeek$day %in% weekdays, 
                          levels=c(FALSE, TRUE), labels = c("weekend", "weekday"))
```

* Subsetting the Data in Weekdays and Weekend
```{r, echo=TRUE}
weekends <- dataWeek[dataWeek$weekClass=="weekend",]
weekendSum <- aggregate(steps ~ interval, data=weekends, FUN="sum")

weekdays <- dataWeek[dataWeek$weekClass=="weekday",]
weekdaySum <- aggregate(steps ~ interval, data=weekdays, FUN="sum")

```

* Make a panel plot containing a time series plot (i.e. ???????????????? = "????") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis).

```{r}
par(mfrow=c(2,1))
plot(weekdaySum$interval, weekdaySum$steps, ylab = "Weekday Steps", xlab = "Weekdays Interval ", type="l", main="Weekday Activity")

plot(weekendSum$interval, weekendSum$steps, ylab = "Weekend Steps", xlab = "Weekends Interval", type="l", main="Weekend Activity")

## saving the plot
dev.copy(png,'data-weekdays-weekend.png',  width = 480, height = 480)
dev.off()
```

* ANSWER QUESTION 5: During the weekdays there is a spike of activity in the morning. On the weekends, the activity pattern is dynamic throughout the day.




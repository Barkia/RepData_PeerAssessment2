---
title: "Reproducible Research: Peer Assessment 2"
author: Jose Antonio R Neto (joseantonio@me.com)
output: 
  html_document:
    keep_md: true
---
# 1: TITLE: DATASET ANALYSIS FROM NOAA TO IDENTIFY HEALTH AND ECONOMIC POPULATION CONSEQUENCES IN THE UNITED STATES CAUSED BY STORMS AND WEATHER EVENTS


## INTRODUCTION
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.


# 2: SYNOPSIS: QUESTIONS TO BE ANSWERED
This report address the following questions:

1 - Across the United States, which types of events are most harmful with respect to population health?

2 - Across the United States, which types of events have the greatest economic consequences?


# 3: LOADING AND PRE-PROCESSING THE DATA

* Defining libraries

```{r}
getwd()
library(knitr)
library(markdown)
library(rmarkdown)
library(plyr)
library(dplyr)
library(Hmisc)
```

* Loading the data NOAA storm data into R

```{r, echo=TRUE}
if (!file.exists("repdata-data-StormData.csv")) {
        download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", "repdata_data_StormData.csv.bz2")
}
storm <- read.csv(file = "repdata-data-StormData.csv", header = TRUE, sep = ",")
```

* Rows and Columns of Data
```{r, echo=TRUE}
dim(storm)
```
* The Dataset has 902297 rows (observations) and 37 columns (variables). 
* The variables are:
```{r, echo=TRUE}
names(storm)
str(storm)
```

* See two Observations of STORM Dataset

```{r, echo=TRUE}
head(storm, n=2)
```


# 4: PROCESSING THE DATA

Lets answer the question about Which Types of Events are most Harmful for population HEALTH?


## 4.1 - WHICH TYPES OF EVENTS THAT ARE MOST HARMFUL TO POPULATION HEALTH?

The item 2.6 (page 9) of National Weather Service Storm Data documentation describes about Fatalities and Injuries. So, it is necessary to assess theses Variables to define which of EVENTS (EVTYPE) are most harmful. If you want, connect with National Weather Service using the link [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

* Lets evaluate the number of FATALITIES and INJURIES per Type of Event (EVTYPE)

* NUMBER of FATALITIES per EVENT:

```{r, echo= TRUE}
sumFatalities <- aggregate(FATALITIES ~ EVTYPE, data = storm,  FUN="sum")
sumFatalities  ## 985 observations
```

* We have 985 observations, which is a great number of Events to present in a Plot. So, lets stay just with the 10 most harmful events.

* Ordering Number of Fatalities and defining the top 10 Weather events in this category

```{r, echo=TRUE}
fatalities10events <- sumFatalities[order(-sumFatalities$FATALITIES), ][1:10, ]
fatalities10events
```

* BarPlot of the 10 Fatalities Events most harmful to population Health.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 4, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(fatalities10events$FATALITIES, names.arg = fatalities10events$EVTYPE, las = 2, main = "10 Fatalities Highest Events", ylab = "Number of Fatalities")
dev.copy(png, "fatalities-events.png", width = 480, height = 480)
dev.off()
```

* Now, using the same reasoning, let's evaluate the Number of INJURIES per type of Event (EVTYPE)


```{r, echo= TRUE}
sumInjuries <- aggregate(INJURIES ~ EVTYPE, data = storm,  FUN="sum")
sumInjuries  ## 985 observations
```

* We have 985 observations, which is a great number of Events to present in a Plot. So, lets stay just with the 10 most harmful events.

* Ordering Number of INJURIES and defining the top 10 Weather events in this category

```{r, echo=TRUE}
injuries10events <- sumInjuries[order(-sumInjuries$INJURIES), ][1:10, ]
injuries10events
```

* BarPlot of the 10 INJURIES Events most harmful to population Health.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 6, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(injuries10events$INJURIES, names.arg = injuries10events$EVTYPE, las = 2, main = "10 Injuries Highest Events", ylab = "Number of Injuries")
dev.copy(png, "injuries-events.png", width = 480, height = 480)
dev.off()
```

* You can observe looking tho the Plots that TORNADOS events causes the greatest number of Fatalities and Injuries.  


################# 



## 4.2 - WHICH TYPES OF EVENTS HAVE THE GREATES ECONOMIC CONSEQUENCES?


The item 2.7 (page 12 and the APPENDIX B) of National Weather Service Storm Data documentation describes about Damage. Two variables, PROPDMG (for Property Damage) and CROPDMG (for Crop Damage) are used to represent these losts. If you want, read more about this damages, please connect with National Weather Service using the link [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

### PREPARING THE DATA FOR PROPERTIES DAMAGES
```{r, echo=TRUE}


```


* Lets evaluate the Events with Highest Property Damages.

### PROPERTY DAMAGE

 

```{r, echo= TRUE}
sumPropertyevents <- aggregate(PROPDMG ~ EVTYPE, data = storm,  FUN="sum")
sumPropertyevents  ## 985 observations
```

* We have 985 observations, which is a great number of Events to present in a Plot. So, lets stay just with the 10 most harmful events.

* Ordering sun of Property Damage and defining the top 10 Weather events in this category

```{r, echo=TRUE}
propdmg10events <- sumPropertyevents[order(-sumPropertyevents$PROPDMG), ][1:10, ]
propdmg10events
```

* BarPlot of the 10 Propery Damage Events most harmful to population economic.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 6, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(propdmg10events$PROPDMG, names.arg = propdmg10events$EVTYPE, las = 2, main = "10 Property Damages Highest Events", ylab = "Damage Values in $ Billions")
dev.copy(png, "propdmg-events.png", width = 480, height = 480)
dev.off()
```






# 5: RESULTS AND CONCLUSIONS






## las

## saving the plot
dev.copy(png,'hist-total-steps.png',  width = 480, height = 480)
dev.off()
```

* Lets Evaluate the number of 



# CODIGO DA SEMANA 2



* Calculate the sum of steps taken by day

```{r, echo= TRUE}
sumFatalities <- aggregate(FATALITIES ~ EVTYPE, data = storm,  FUN="sum")
sumFatalities
```

* Histogram of the total number of steps taken each day.

```{r, echo = TRUE}
hist(sumFatalities$FATALITIES, col = 'blue',  xlab = 'EVTYPE', main = "Fatalities per Event")

## saving the plot
dev.copy(png,'hist-total-steps.png',  width = 480, height = 480)
dev.off()
```

* Calculate the mean and median of the total number of steps taken per day 

* Total Mean Steps taken per day
```{r, echo = TRUE}
meanStepsPerDay <- aggregate(steps ~ date, data = activity, FUN = "mean")
meanStepsPerDay
totalMeanSteps <- mean(sumSteps$steps)
totalMeanSteps
```

* Total Median Steps 
```{r, echo = TRUE}
totalMedianSteps <- median(sumSteps$steps)
totalMedianSteps
```


## 3 - What is the average daily activity pattern?

* Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r, echo=TRUE}
averageSteps <- aggregate(steps~interval, data=activity, FUN="mean")
averageSteps
```

* Time series plot of the average number of steps taken

```{r, echo=TRUE}
plot(x = averageSteps$interval, y = averageSteps$steps, type = "l", lwd=2, xlab = "Intervals",
     ylab = "Average number of steps", main = "Average Daily activity Pattern")
## saving the plot
dev.copy(png,'average-number-steps.png',  width = 480, height = 480)
dev.off()
```


* Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of step

```{r, echo=TRUE}
averageSteps[which.max(averageSteps$steps),]
averageSteps[which.max(averageSteps$steps),]$interval

```


## 4 - Strategy of Imputing Missing Values

* Total number of missing values (total rows with NAs) 

```{r, echo=TRUE}
missingValues <- is.na(activity$steps)
table(missingValues)
```

* Creating a New Dataset (wrangling it). Filling the missing data with average.

```{r, echo=TRUE}
newDataset <- activity
newDataset$steps <- with(newDataset,impute(steps,mean))
newDataset$date <- as.Date(newDataset$date)
str(newDataset)
sumNewdataset <- aggregate(steps ~ date, data = newDataset, FUN = "sum", na.rm = TRUE)
sumNewdataset
```

* Histogram of the total number of steps taken each day after missing values are imputed.

```{r, echo=TRUE}
hist(sumNewdataset$steps, main="Steps Per Day By Frequency",xlab="Daily Steps")
## saving the plot
dev.copy(png,'steps-each-day.png',  width = 480, height = 480)
dev.off()
```

* Mean and Median of newDataset

```{r, echo=TRUE}
mean(sumNewdataset$steps, na.rm = TRUE)
median(sumNewdataset$steps, na.rm = TRUE)
```


## 5 - Are there differences in activity patterns between weekdays and weekends?
* Use function Weekdays()

```{r, echo=TRUE}
dataWeek <- transform(newDataset, day = weekdays(date))
```


* Create a new factor variable in the dataset with two levels ??? ???weekday??? and ???weekend??? indicating whether a given date is a weekday or weekend day.

```{r, echo=TRUE}
weekdays <- c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
weekdays
dataWeek$weekClass <- factor(dataWeek$day %in% weekdays, 
                          levels=c(FALSE, TRUE), labels = c("weekend", "weekday"))
```

* Subsetting the Data in Weekdays and Weekend
```{r, echo=TRUE}
weekends <- dataWeek[dataWeek$weekClass=="weekend",]
weekendSum <- aggregate(steps ~ interval, data=weekends, FUN="sum")

weekdays <- dataWeek[dataWeek$weekClass=="weekday",]
weekdaySum <- aggregate(steps ~ interval, data=weekdays, FUN="sum")

```

* Make a panel plot containing a time series plot (i.e. ???????????????? = "????") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis).

```{r}
par(mfrow=c(2,1))
plot(weekdaySum$interval, weekdaySum$steps, ylab = "Weekday Steps", xlab = "Weekdays Interval ", type="l", main="Weekday Activity")

plot(weekendSum$interval, weekendSum$steps, ylab = "Weekend Steps", xlab = "Weekends Interval", type="l", main="Weekend Activity")

## saving the plot
dev.copy(png,'data-weekdays-weekend.png',  width = 480, height = 480)
dev.off()
```

 




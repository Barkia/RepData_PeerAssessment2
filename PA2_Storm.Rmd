---
title: "Reproducible Research: Peer Assessment 2"
author: Jose Antonio R Neto (joseantonio@me.com)
output: 
  html_document:
    keep_md: true
---
# 1: Title: Health/Economic Consequences in U.S. caused by Storms ans Weather Events


## INTRODUCTION
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This Data Science Project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

Look to link: [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf). At pag.51 there of this document, there is an example, evolving Hurricane Andrew where the powerful winds resulted in 4 fatalities, 50 injuries, $13B in property damage and $ 750M in crop damage.

Notation Example pag.51: FLZ018-021 >023 24 0325EST 4 50 13B 750M Hurricane/Typhoon 0900EST

# 2: PROJECT SYNOPSIS: 
This report address questions related to Weather Events and Storms that are most damaging in terms of Fatalities, Injuries and damages at properties and crop using the NOAA database. 
The mainly questions to be answered are:
1 - Which types of events are most harmful with respect to population health?
2 - Which types of events have the greatest economic consequences?

# 3: LOADING THE DATA

### 3.1 - Using R libraries

```{r, echo=TRUE}
getwd()
library(knitr)
library(markdown)
library(rmarkdown)
library(plyr)
library(dplyr)
library(stats)
library(R.utils)
```

* This analysis was done at iMac i5 3.1 Ghz with 8GB RAM and 1TB of Disk.

```{r, echo=TRUE}
sessionInfo()
```

### 3.2 - Loading the data NOAA storm data into R

```{r, echo=TRUE}
if (!file.exists("repdata-data-StormData.csv")) {
        download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", "repdata_data_StormData.csv.bz2")
}
storm <- read.csv(file = "repdata-data-StormData.csv", header = TRUE, sep = ",")
dim(storm)
names(storm)
str(storm)
```

### 3.3 - Wrangling the Data

* Defining variables that will be used:
EVTYPE: Event Type (Tornados, Flood, ....)
FATALITIES: Number of Fatalities
INJURIES: Number of Injuries
PROGDMG: Property Damage + PROPDMGEXP: Units for Property Damage (K,M,B)
CROPDMG: Crop Damage + CROPDMGEXP: Units for Crop Damage (K,BM,B)

```{r, echo=TRUE}
varsNedeed <- c("EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP", "CROPDMG", "CROPDMGEXP")
storm <- storm[varsNedeed]
dim(storm)
names(storm)
str(storm)
head(storm)
```

* Refactor and redefining values for the PROGDMGEXP variable
```{r, echo=TRUE}
unique(storm$PROPDMGEXP)
storm$PROPDMGEXP <- mapvalues(storm$PROPDMGEXP, from = c("K", "M","", "B", "m", "+", "0", "5", "6", "?", "4", "2", "3", "h", "7", "H", "-", "1", "8"), to = c(10^3, 10^6, 1, 10^9, 10^6, 1,1,10^5, 10^6,1,10^4,10^2,10^3,10^3,10^7,10^3,1,1,10^8))
```

* Refactor and redefining values for CROPDMGEXP variable
```{r, echo=TRUE}
unique(storm$CROPDMGEXP)
storm$CROPDMGEXP <- mapvalues(storm$CROPDMGEXP, from = c("M", "K", "m", "B", "?", "0", "k","2"), to = c(10^6, 10^3, 10^6, 10^9, 1, 1, 10^3, 10^2))
```


# 4: PROCESSING THE DATA

Lets answer the question about Which Types of Events are most Harmful for population HEALTH?


## 4.1 - WHICH TYPES OF EVENTS ARE MOST HARMFUL TO POPULATION HEALTH?

The item 2.6 (page 9) of National Weather Service Storm Data documentation describes about Fatalities and Injuries. So, it is necessary to assess these Variables to define which of EVENTS (EVTYPE) are most harmful. Look to link: [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

* Lets to evaluate the number of FATALITIES and INJURIES per Type of Event (EVTYPE)

### 4.1.1 - NUMBER OF FATALITIES PER EVENT

```{r, echo= TRUE}
sumFatalities <- aggregate(FATALITIES ~ EVTYPE, data = storm,  FUN="sum")
dim(sumFatalities)  ## 985 observations
```

* We have 985 observations, which is a great number of Events to present in a Plot.
* Ordering Number of Fatalities and defining the top 10 Weather events in this category

```{r, echo=TRUE}
fatalities10events <- sumFatalities[order(-sumFatalities$FATALITIES), ][1:10, ]
dim(fatalities10events)
fatalities10events
```

* BarPlot of the 10 Fatalities Events most harmful to population Health.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 4, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(fatalities10events$FATALITIES, names.arg = fatalities10events$EVTYPE, las = 2, main = "10 Fatalities Highest Events", ylab = "Number of Fatalities")
dev.copy(png, "fatalities-events.png", width = 480, height = 480)
dev.off()
```


### 4.1.2 - NUMBER OF INJURIES PER EVENT

Using the same reasoning of Fatalities, let's evaluate the Number of Injuries per type of Event (EVTYPE)

```{r, echo= TRUE}
sumInjuries <- aggregate(INJURIES ~ EVTYPE, data = storm,  FUN="sum")
dim(sumInjuries)  ## 985 observations
```

* Ordering Number of INJURIES and defining the top 10 Weather events in this category

```{r, echo=TRUE}
injuries10events <- sumInjuries[order(-sumInjuries$INJURIES), ][1:10, ]
dim(injuries10events)
injuries10events
```

* BarPlot of the 10 INJURIES Events most harmful to population Health.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 6, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(injuries10events$INJURIES, names.arg = injuries10events$EVTYPE, las = 2, main = "10 Injuries Highest Events", ylab = "Number of Injuries")
dev.copy(png, "injuries-events.png", width = 480, height = 480)
dev.off()
```


## 4.2 - WHICH TYPES OF EVENTS HAVE THE GREATES ECONOMIC CONSEQUENCES?

The item 2.7 (page 12 and the APPENDIX B) of National Weather Service Storm Data documentation describes about Damage. Two variables, PROPDMG (for Property Damage) and CROPDMG (for Crop Damage) are used to represent these losts. If you want, read more about this damages, please connect with National Weather Service using the link [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

### 4.2.1 - PREPARING THE DATA FOR PROPERTIES DAMAGES

```{r, echo=TRUE}


```


* Lets evaluate the Events with Highest Property Damages.

### PROPERTY DAMAGE


```{r, echo= TRUE}
sumPropertyevents <- aggregate(PROPDMG ~ EVTYPE, data = storm,  FUN="sum")
sumPropertyevents  ## 985 observations
```

* We have 985 observations, which is a great number of Events to present in a Plot. So, lets stay just with the 10 most harmful events.

* Ordering sun of Property Damage and defining the top 10 Weather events in this category

```{r, echo=TRUE}
propdmg10events <- sumPropertyevents[order(-sumPropertyevents$PROPDMG), ][1:10, ]
propdmg10events
```

* BarPlot of the 10 Propery Damage Events most harmful to population economic.

```{r, echo = TRUE}
par(mfrow = c(1,1), mar = c(10, 6, 3, 2), mgp = c(3, 1, 0), cex = 0.6)
barplot(propdmg10events$PROPDMG, names.arg = propdmg10events$EVTYPE, las = 2, main = "10 Property Damages Highest Events", ylab = "Damage Values in $ Billions")
dev.copy(png, "propdmg-events.png", width = 480, height = 480)
dev.off()
```



# 5: RESULTS AND CONCLUSIONS



 



